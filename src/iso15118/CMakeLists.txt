find_package(Threads REQUIRED)

add_library(iso15118)
add_library(iso15118::iso15118 ALIAS iso15118)
target_include_directories(iso15118
    PUBLIC
        $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include>
)

target_sources(iso15118
    PRIVATE
        misc/helper.cpp
        misc/cb_exi.cpp

        io/connection_plain.cpp
        io/logging.cpp
        io/poll_manager.cpp
        io/sdp_packet.cpp
        io/sdp_server.cpp
        io/socket_helper.cpp

        session/feedback.cpp
        session/iso.cpp
        session/logger.cpp

        d20/context.cpp
        d20/context_helper.cpp
        d20/control_event_queue.cpp
        d20/session.cpp
        d20/timeout.cpp
        d20/config.cpp

        d20/state/supported_app_protocol.cpp
        d20/state/session_setup.cpp
        d20/state/authorization_setup.cpp
        d20/state/authorization.cpp
        d20/state/service_discovery.cpp
        d20/state/service_detail.cpp
        d20/state/service_selection.cpp
        d20/state/ac_charge_parameter_discovery.cpp
        d20/state/dc_charge_parameter_discovery.cpp
        d20/state/schedule_exchange.cpp
        d20/state/dc_cable_check.cpp
        d20/state/dc_pre_charge.cpp
        d20/state/power_delivery.cpp
        d20/state/dc_charge_loop.cpp        
        d20/state/dc_welding_detection.cpp
        d20/state/ac_charge_loop.cpp
        d20/state/session_stop.cpp
        
        message_d20/variant.cpp
        message_d20/supported_app_protocol.cpp
        message_d20/session_setup.cpp
        message_d20/common_types.cpp
        message_d20/authorization_setup.cpp
        message_d20/authorization.cpp
        message_d20/service_discovery.cpp
        message_d20/service_detail.cpp
        message_d20/service_selection.cpp
        message_d20/ac_charge_parameter_discovery.cpp
        message_d20/dc_charge_parameter_discovery.cpp
        message_d20/schedule_exchange.cpp
        message_d20/dc_cable_check.cpp
        message_d20/dc_pre_charge.cpp
        message_d20/power_delivery.cpp
        message_d20/ac_charge_loop.cpp
        message_d20/dc_charge_loop.cpp
        message_d20/dc_welding_detection.cpp
        message_d20/session_stop.cpp

        tbd_controller.cpp    
)

target_link_libraries(iso15118
    PUBLIC
        # FIXME (aw): would be nice if we could make this private!
        cbv2g::tp
        cbv2g::iso20
    PRIVATE
        Threads::Threads
)

target_link_libraries(iso15118
    PRIVATE
        OpenSSL::SSL
        OpenSSL::Crypto
)
target_sources(iso15118
    PRIVATE
    io/connection_ssl.cpp
    misc/helper_ssl.cpp
)

# FIXME (aw): do we want to have this public here?
target_compile_features(iso15118 PUBLIC cxx_std_17)

target_compile_options(iso15118 PRIVATE ${ISO15118_COMPILE_OPTIONS_WARNING})
